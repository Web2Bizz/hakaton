# Рефакторинг проекта EcoQuest

## Выполненные улучшения

### 1. Унификация типов
- ✅ Создан `src/types/common.ts` с общими типами (`AssistanceTypeId`, `SocialLink`, `Coordinates`, `ContactInfo`)
- ✅ Удалено дублирование типов между `organizations.ts` и `types.ts`
- ✅ Все компоненты используют единые типы из `@/types/common`

### 2. Централизация констант
- ✅ Создан `src/constants/index.ts` с общими константами:
  - `ASSISTANCE_OPTIONS` - опции помощи
  - `DEFAULT_MAP_CENTER`, `DEFAULT_MAP_ZOOM`, `SEARCH_MAP_ZOOM` - настройки карты
  - `ANIMATION_DURATION` - длительность анимаций
  - `NOTIFICATION_MAX_COUNT` - максимум уведомлений
  - `QUICK_DONATION_AMOUNTS` - быстрые суммы донатов

### 3. Утилиты форматирования
- ✅ Создан `src/utils/format.ts` с функциями:
  - `formatDate()` - форматирование даты
  - `formatDateTime()` - форматирование даты и времени
  - `formatShortDate()` - короткий формат даты
  - `formatCurrency()` - форматирование валюты
- ✅ Все компоненты используют единые функции форматирования

### 4. Утилиты для квестов
- ✅ Создан `src/utils/quest.ts` с функциями:
  - `calculateQuestProgress()` - расчет прогресса квеста
  - `getQuestProgressColor()` - определение цвета по прогрессу
  - `findStageById()` - поиск этапа по ID
  - `getActiveStages()`, `getCompletedStages()` - фильтрация этапов

### 5. Улучшение хуков
- ✅ Создан `src/hooks/useLocalStorage.ts` - универсальный хук для работы с localStorage
- ✅ `UserContext` и `NotificationContext` используют `useLocalStorage` вместо прямого обращения к localStorage
- ✅ Добавлена синхронизация между вкладками браузера

### 6. Barrel Exports
- ✅ Создан `src/components/map/index.ts` - централизованный экспорт компонентов карты
- ✅ Создан `src/utils/index.ts` - экспорт всех утилит
- ✅ Создан `src/types/index.ts` - экспорт всех типов

### 7. Оптимизация импортов
- ✅ Все компоненты используют константы из `@/constants`
- ✅ Все компоненты используют утилиты из `@/utils`
- ✅ Убраны дублирующиеся импорты
- ✅ Улучшена читаемость кода

### 8. Улучшение типизации
- ✅ Добавлены типы `Coordinates`, `ContactInfo` для лучшей типизации
- ✅ Все интерфейсы используют общие типы
- ✅ Улучшена консистентность типов

## Структура после рефакторинга

```
src/
├── types/
│   ├── common.ts          # Общие типы (новый)
│   ├── user.ts
│   ├── notifications.ts
│   └── index.ts           # Barrel export (новый)
├── constants/
│   └── index.ts           # Все константы (новый)
├── utils/
│   ├── format.ts          # Форматирование (новый)
│   ├── quest.ts           # Утилиты квестов (новый)
│   ├── constants.ts       # Вспомогательные константы (новый)
│   └── index.ts           # Barrel export (новый)
├── hooks/
│   └── useLocalStorage.ts # Хук для localStorage (новый)
├── components/
│   └── map/
│       └── index.ts       # Barrel export (новый)
└── contexts/
    ├── UserContext.tsx    # Использует useLocalStorage
    └── NotificationContext.tsx # Использует useLocalStorage
```

## Преимущества рефакторинга

1. **Меньше дублирования** - общие типы и константы в одном месте
2. **Лучшая поддерживаемость** - изменения в одном месте применяются везде
3. **Улучшенная читаемость** - единообразные импорты и структура
4. **Типобезопасность** - улучшенная типизация
5. **Переиспользование** - утилиты можно использовать в любом месте
6. **Производительность** - оптимизированные хуки и константы

## Следующие шаги (опционально)

- [ ] Добавить мемоизацию для тяжелых вычислений
- [ ] Создать компоненты-обертки для часто используемых паттернов
- [ ] Добавить тесты для утилит
- [ ] Оптимизировать bundle size

