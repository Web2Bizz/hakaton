# План тестирования проекта Hakaton Client

## Общая информация

**Цель:** Достичь 90% покрытия кода тестами  
**Типы тестов:** Unit, Integration, E2E  
**Технологический стек:**

- React 19
- TypeScript
- Redux Toolkit + RTK Query
- React Hook Form + Zod
- React Router (file-based routing)
- Leaflet (карты)
- Vitest (рекомендуется для unit/integration)
- React Testing Library
- Playwright/Cypress (для E2E)

---

## 1. UNIT ТЕСТЫ

### 1.3 Схемы валидации (Schemas)

#### `src/components/forms/quest/schemas/quest-form.schema.ts`

- ✅ `questFormSchema` - валидация формы квеста
  - Обязательные поля (title, cityId, organizationTypeId, category, story, address, contacts, latitude, longitude, stages)
  - Минимальная длина title (3 символа)
  - Минимальная длина story (20 символов)
  - Валидация координат (широта -90 до 90, долгота -180 до 180)
  - Минимум один контакт
  - Минимум один этап
  - Валидация email куратора
  - Валидация customAchievement
  - Валидация stages (stageFormSchema)
- ✅ `stageFormSchema` - валидация этапа
  - Обязательные поля
  - Статус (pending, in_progress, completed)
  - Прогресс (0-100)
  - Тип требования
  - Значение требования
- ✅ `customAchievementSchema` - валидация достижения
  - Эмодзи
  - Название
  - Описание
- ✅ `contactSchema` - валидация контакта
- ✅ `socialLinkSchema` - валидация социальной ссылки

#### `src/components/forms/organization/schemas/organization-form.schema.ts`

- ✅ `organizationFormSchema` - валидация формы организации
  - Все обязательные поля
  - Минимальные длины
  - Валидация координат
  - Минимум один helpTypeId
  - Минимум один контакт
- ✅ `contactSchema` - валидация контакта

#### `src/components/forms/registration/RegistrationForm.tsx`

- ✅ `registrationSchema` - валидация регистрации
  - Обязательные поля (firstName, lastName, middleName, email, password, confirmPassword)
  - Валидация email
  - Минимальная длина пароля (6 символов)
  - Максимальная длина пароля (100 символов)
  - Совпадение паролей

#### `src/components/forms/login/LoginForm.tsx`

- ✅ `loginSchema` - валидация входа
  - Email обязателен
  - Валидация email
  - Пароль обязателен

#### `src/components/forms/forgot-password/ForgotPasswordForm.tsx`

- ✅ Валидация email для восстановления пароля

#### `src/components/forms/reset-password/ResetPasswordForm.tsx`

- ✅ Валидация токена и нового пароля
  - Совпадение паролей

### 1.4 Трансформеры (Transformers)

#### `src/components/forms/quest/utils/questTransformers.ts`

- ✅ `transformFormDataToCreateRequest()` - преобразование формы в запрос
  - Все поля корректно преобразуются
  - Обработка optional полей
  - Преобразование stages
  - Преобразование achievement
  - Преобразование contacts
  - Преобразование socials

### 1.5 Redux Store

#### `src/store/store.ts`

- ✅ Настройка store
- ✅ Redux Persist конфигурация
- ✅ Комбинация всех редьюсеров
- ✅ Middleware настройка
- ✅ Сериализация/десериализация

#### `src/store/baseQueryWithReauth.ts`

- ✅ Базовый запрос с токеном
- ✅ Обновление токена при 401
- ✅ Обработка refresh token
- ✅ Повтор запроса после обновления токена
- ✅ Очистка токенов при ошибке refresh
- ✅ Логирование (можно мокировать)

### 1.6 RTK Query Services

#### `src/store/entities/auth/model/auth-service.ts`

- ✅ `register` mutation
- ✅ `login` mutation
- ✅ `forgotPassword` mutation
- ✅ `resetPassword` mutation
- ✅ `refreshToken` mutation
- ✅ `getUser` query
- ✅ `updateUser` mutation
- ✅ Инвалидация тегов

#### `src/store/entities/quest/model/quest-service.ts`

- ✅ `getQuests` query с фильтрами
  - Параметры фильтрации (cityId, organizationTypeId, categoryIds, status, search, page, limit, sort)
  - Построение query string
  - Transform response
- ✅ `getQuest` query
- ✅ `createQuest` mutation
- ✅ `updateQuest` mutation
- ✅ `deleteQuest` mutation
- ✅ `archiveQuest` mutation
- ✅ `completeQuest` mutation
- ✅ `getQuestUpdates` query
- ✅ `createQuestUpdate` mutation
- ✅ `updateQuestUpdate` mutation
- ✅ `deleteQuestUpdate` mutation
- ✅ `getQuestParticipants` query
- ✅ `markVolunteer` mutation
- ✅ `unmarkVolunteer` mutation
- ✅ Инвалидация тегов

#### `src/store/entities/organization/model/organization-service.ts`

- ✅ `getOrganizations` query
- ✅ `getMyOrganizations` query
- ✅ `getOrganization` query
- ✅ `createOrganization` mutation
- ✅ `updateOrganization` mutation
- ✅ `deleteOrganization` mutation
- ✅ `getOrganizationUpdates` query
- ✅ `createOrganizationUpdate` mutation
- ✅ `updateOrganizationUpdate` mutation
- ✅ `deleteOrganizationUpdate` mutation
- ✅ Transform responses
- ✅ Инвалидация тегов

#### `src/store/entities/category/model/category-service.ts`

- ✅ `getCategories` query
- ✅ Transform response (обработка разных форматов)

#### `src/store/entities/city/model/city-service.ts`

- ✅ `getCities` query

#### `src/store/entities/achievement/model/achievement-service.ts`

- ✅ Все endpoints для достижений

#### `src/store/entities/experience/model/experience-service.ts`

- ✅ Все endpoints для опыта

#### `src/store/entities/organization-type/model/organization-type-service.ts`

- ✅ `getOrganizationTypes` query

#### `src/store/entities/help-type/model/help-type-service.ts`

- ✅ `getHelpTypes` query

#### `src/store/entities/upload/model/upload-service.ts`

- ✅ `uploadImage` mutation

### 1.7 Компоненты (UI Components)

#### `src/components/ui/*`

- ✅ Все базовые UI компоненты
  - Button
  - Input
  - Form компоненты
  - Dialog
  - Toast
  - Spinner
  - И другие

#### `src/components/header/header.tsx`

- ✅ Отображение навигации
- ✅ Отображение пользователя
- ✅ Кнопка выхода
- ✅ Условный рендеринг для авторизованных/неавторизованных

#### `src/components/profile/*`

- ✅ Отображение профиля пользователя
- ✅ Редактирование профиля
- ✅ Статистика пользователя
- ✅ Достижения

### 1.8 Контексты

#### `src/contexts/UserContext.tsx`

- ✅ Инициализация из localStorage
- ✅ Нормализация уровня при загрузке
- ✅ Обновление пользователя
- ✅ Предоставление контекста

#### `src/pwa/PWAContext.tsx`

- ✅ Определение установленного приложения
- ✅ Отслеживание онлайн/оффлайн статуса
- ✅ Обработка beforeinstallprompt
- ✅ Уведомления об изменении статуса

### 1.9 Protected Route

#### `src/provider/ProtectedRoute.tsx`

- ✅ Редирект на /login при отсутствии пользователя
- ✅ Рендеринг children при наличии пользователя
- ✅ Обработка загрузки

---

## 2. INTEGRATION ТЕСТЫ

### 2.1 Формы

#### `src/components/forms/quest/AddQuestForm.tsx`

- ✅ Загрузка формы с начальными значениями
- ✅ Валидация всех полей
- ✅ Отображение ошибок валидации
- ✅ Загрузка изображений
- ✅ Отправка формы
- ✅ Обработка успешной отправки
- ✅ Обработка ошибок API
- ✅ Интеграция с useQuestForm
- ✅ Интеграция с useQuestSubmission
- ✅ Интеграция с useQuestImageUpload
- ✅ Синхронизация контактов (useQuestContactSync)
- ✅ Управление этапами
- ✅ Управление достижениями

#### `src/components/forms/quest/QuestUpdateForm.tsx`

- ✅ Загрузка данных квеста
- ✅ Заполнение формы существующими данными
- ✅ Обновление квеста
- ✅ Валидация
- ✅ Обработка ошибок

#### `src/components/forms/organization/AddOrganizationForm.tsx`

- ✅ Загрузка формы
- ✅ Валидация
- ✅ Загрузка изображений
- ✅ Отправка формы
- ✅ Интеграция с API
- ✅ Управление обновлениями организации

#### `src/components/forms/organization/OrganizationUpdateForm.tsx`

- ✅ Загрузка данных организации
- ✅ Обновление организации
- ✅ Валидация

#### `src/components/forms/login/LoginForm.tsx`

- ✅ Валидация формы
- ✅ Отправка запроса на вход
- ✅ Сохранение токенов
- ✅ Обновление пользователя в контексте
- ✅ Редирект после успешного входа
- ✅ Отображение ошибок

#### `src/components/forms/registration/RegistrationForm.tsx`

- ✅ Валидация всех полей
- ✅ Проверка совпадения паролей
- ✅ Отправка регистрации
- ✅ Автоматический вход после регистрации
- ✅ Обработка ошибок

#### `src/components/forms/forgot-password/ForgotPasswordForm.tsx`

- ✅ Валидация email
- ✅ Отправка запроса
- ✅ Отображение сообщения об успехе

#### `src/components/forms/reset-password/ResetPasswordForm.tsx`

- ✅ Валидация токена
- ✅ Валидация паролей
- ✅ Сброс пароля
- ✅ Редирект на логин

### 2.2 Хуки форм

#### `src/components/forms/quest/hooks/useQuestForm.ts`

- ✅ Инициализация формы
- ✅ Интеграция с useQuestContactSync
- ✅ Интеграция с useQuestImageUpload
- ✅ Интеграция с useQuestSubmission
- ✅ Загрузка данных для селектов (города, типы)

#### `src/components/forms/quest/hooks/useQuestSubmission.ts`

- ✅ Валидация лимита квестов
- ✅ Валидация местоположения
- ✅ Валидация пользовательского достижения
- ✅ Загрузка изображений
- ✅ Создание квеста
- ✅ Обновление пользователя
- ✅ Обработка ошибок
- ✅ Вызов onSuccess callback

#### `src/components/forms/quest/hooks/useQuestImageUpload.ts`

- ✅ Загрузка storyImage
- ✅ Загрузка gallery
- ✅ Обработка ошибок загрузки
- ✅ Прогресс загрузки

#### `src/components/forms/quest/hooks/useQuestContactSync.ts`

- ✅ Синхронизация между contacts и curator полями
- ✅ Обновление при изменении contacts
- ✅ Обновление при изменении curator полей

#### `src/components/forms/quest/hooks/useQuestAchievement.ts`

- ✅ Управление достижениями
- ✅ Выбор существующего достижения
- ✅ Создание пользовательского достижения

#### `src/components/forms/organization/hooks/useOrganizationForm.ts`

- ✅ Инициализация формы
- ✅ Валидация
- ✅ Отправка формы
- ✅ Интеграция с API

### 2.3 Компоненты управления

#### `src/components/manage/QuestManagement.tsx`

- ✅ Отображение информации о квесте
- ✅ Управление этапами
- ✅ Управление требованиями
- ✅ Управление обновлениями
- ✅ Управление участниками
- ✅ Интеграция с API

#### `src/components/manage/QuestEditForm.tsx`

- ✅ Загрузка данных квеста
- ✅ Редактирование
- ✅ Сохранение изменений
- ✅ Интеграция с useQuestEditForm

#### `src/components/manage/OrganizationEditForm.tsx`

- ✅ Загрузка данных организации
- ✅ Редактирование
- ✅ Сохранение изменений
- ✅ Интеграция с useOrganizationEditForm

#### `src/components/manage/QuestArchiveButton.tsx`

- ✅ Архивация квеста
- ✅ Подтверждение действия
- ✅ Обновление списка

#### `src/components/manage/QuestCompleteButton.tsx`

- ✅ Завершение квеста
- ✅ Подтверждение
- ✅ Обновление статуса

#### `src/components/manage/QuestRequirementManager.tsx`

- ✅ Отображение требований
- ✅ Добавление требований
- ✅ Обновление требований
- ✅ Удаление требований

#### `src/components/manage/QRCodeDisplay.tsx`

- ✅ Генерация QR кода
- ✅ Отображение QR кода

### 2.4 Карта

#### `src/components/map/ui/Map.tsx`

- ✅ Инициализация карты
- ✅ Загрузка квестов и организаций
- ✅ Применение фильтров
- ✅ Выбор квеста/организации
- ✅ Поиск по адресу
- ✅ Центрирование на пользователе
- ✅ Интеграция с useMapState
- ✅ Интеграция с useMapControls
- ✅ Интеграция с useMapHandlers
- ✅ Интеграция с useGeolocation

#### `src/components/map/ui/UnifiedMapView.tsx`

- ✅ Отображение маркеров квестов
- ✅ Отображение маркеров организаций
- ✅ Кластеризация маркеров
- ✅ Обработка кликов на маркеры
- ✅ Центрирование карты
- ✅ Zoom контролы

#### `src/components/map/ui/MapControls.tsx`

- ✅ Открытие/закрытие фильтров
- ✅ Открытие/закрытие списка
- ✅ Применение фильтров
- ✅ Выбор элемента из списка
- ✅ Центрирование на пользователе

#### `src/components/map/ui/MapSearch.tsx`

- ✅ Поиск по адресу
- ✅ Поиск квестов/организаций
- ✅ Выбор результата поиска
- ✅ Интеграция с картой

#### `src/components/map/ui/MapDetails.tsx`

- ✅ Отображение деталей квеста
- ✅ Отображение деталей организации
- ✅ Закрытие деталей
- ✅ Навигация к управлению

#### `src/components/map/hooks/useMapState.ts`

- ✅ Управление состоянием карты
- ✅ Фильтрация квестов
- ✅ Фильтрация организаций
- ✅ Загрузка данных
- ✅ Управление выбранными элементами

#### `src/components/map/hooks/useMapControls.ts`

- ✅ Управление UI контролами
- ✅ Переключение фильтров/списка
- ✅ Применение фильтров

#### `src/components/map/hooks/useMapHandlers.ts`

- ✅ Обработка выбора квеста
- ✅ Обработка выбора организации
- ✅ Обработка кликов на маркеры
- ✅ Обработка поиска

### 2.5 Страницы

#### `src/pages/page.tsx` (Главная)

- ✅ Отображение главной страницы
- ✅ Навигация

#### `src/pages/(auth)/login/page.tsx`

- ✅ Отображение формы входа
- ✅ Интеграция с LoginForm

#### `src/pages/(auth)/registartion/page.tsx`

- ✅ Отображение формы регистрации
- ✅ Интеграция с RegistrationForm

#### `src/pages/(header)/map/page.tsx`

- ✅ Отображение карты
- ✅ Интеграция с Map компонентом

#### `src/pages/(header)/profile/page.tsx`

- ✅ Отображение профиля
- ✅ Интеграция с компонентами профиля

#### `src/pages/(header)/add-quest/page.tsx`

- ✅ Отображение формы создания квеста
- ✅ Защита маршрута

#### `src/pages/(header)/add-organization/page.tsx`

- ✅ Отображение формы создания организации
- ✅ Защита маршрута

#### `src/pages/(manage)/manage/page.tsx`

- ✅ Отображение списка квестов и организаций
- ✅ Навигация к управлению

#### `src/pages/(manage)/quests/[id]/manage/page.tsx`

- ✅ Загрузка квеста по ID
- ✅ Отображение управления квестом
- ✅ Проверка прав доступа

#### `src/pages/(manage)/organizations/[id]/manage/page.tsx`

- ✅ Загрузка организации по ID
- ✅ Отображение управления организацией
- ✅ Проверка прав доступа

### 2.6 Layout

#### `src/pages/layout.tsx`

- ✅ Инициализация Redux store
- ✅ Redux Persist
- ✅ UserProvider
- ✅ PWAProvider
- ✅ Header
- ✅ Toaster
- ✅ Рендеринг children

### 2.7 PWA

#### `src/pwa/PWAInstallButton.tsx`

- ✅ Отображение кнопки установки
- ✅ Вызов установки
- ✅ Обработка результата

#### `src/pwa/NetworkStatus.tsx`

- ✅ Отображение статуса сети
- ✅ Уведомления об изменении статуса

#### `src/pwa/usePWAInstall.ts`

- ✅ Проверка возможности установки
- ✅ Проверка установленного состояния
- ✅ Функция установки

### 2.8 Redux Integration

#### Интеграция RTK Query с компонентами

- ✅ Использование queries в компонентах
- ✅ Использование mutations в компонентах
- ✅ Кэширование данных
- ✅ Инвалидация кэша
- ✅ Optimistic updates
- ✅ Обработка ошибок
- ✅ Состояния загрузки

#### Redux Persist

- ✅ Сохранение authApi в localStorage
- ✅ Восстановление состояния при загрузке
- ✅ Очистка при logout

---

## 3. E2E ТЕСТЫ

### 3.1 Аутентификация

#### Регистрация пользователя

1. ✅ Переход на страницу регистрации
2. ✅ Заполнение формы регистрации
3. ✅ Валидация полей
4. ✅ Отправка формы
5. ✅ Успешная регистрация
6. ✅ Автоматический вход
7. ✅ Редирект на главную/профиль

#### Вход в систему

1. ✅ Переход на страницу входа
2. ✅ Заполнение email и пароля
3. ✅ Валидация
4. ✅ Успешный вход
5. ✅ Сохранение токенов
6. ✅ Редирект
7. ✅ Отображение пользователя в header

#### Выход из системы

1. ✅ Клик на кнопку выхода
2. ✅ Очистка токенов
3. ✅ Редирект на главную/логин
4. ✅ Отсутствие доступа к защищенным страницам

#### Восстановление пароля

1. ✅ Переход на страницу забытого пароля
2. ✅ Ввод email
3. ✅ Отправка запроса
4. ✅ Получение сообщения
5. ✅ Переход по ссылке из email (мок)
6. ✅ Ввод нового пароля
7. ✅ Подтверждение пароля
8. ✅ Сброс пароля
9. ✅ Вход с новым паролем

### 3.2 Управление квестами

#### Создание квеста

1. ✅ Вход в систему
2. ✅ Переход на страницу создания квеста
3. ✅ Заполнение основной информации
4. ✅ Выбор города
5. ✅ Выбор типа организации
6. ✅ Выбор категории
7. ✅ Ввод описания
8. ✅ Загрузка изображения истории
9. ✅ Загрузка галереи
10. ✅ Выбор местоположения на карте
11. ✅ Добавление контактов
12. ✅ Добавление этапов квеста
13. ✅ Настройка требований для этапов
14. ✅ Добавление достижения (опционально)
15. ✅ Добавление куратора
16. ✅ Добавление социальных сетей
17. ✅ Валидация формы
18. ✅ Отправка формы
19. ✅ Успешное создание
20. ✅ Редирект на карту с зумом на квест

#### Редактирование квеста

1. ✅ Переход на страницу управления квестом
2. ✅ Загрузка данных квеста
3. ✅ Редактирование полей
4. ✅ Добавление/удаление этапов
5. ✅ Обновление требований
6. ✅ Сохранение изменений
7. ✅ Отображение обновленных данных

#### Управление этапами квеста

1. ✅ Просмотр этапов
2. ✅ Добавление нового этапа
3. ✅ Редактирование этапа
4. ✅ Удаление этапа
5. ✅ Изменение статуса этапа
6. ✅ Обновление прогресса

#### Управление требованиями

1. ✅ Просмотр требований этапа
2. ✅ Добавление финансового требования
3. ✅ Добавление требования волонтеров
4. ✅ Добавление требования материалов
5. ✅ Обновление требований
6. ✅ Удаление требований

#### Управление обновлениями квеста

1. ✅ Просмотр обновлений
2. ✅ Создание обновления
3. ✅ Загрузка изображений в обновление
4. ✅ Редактирование обновления
5. ✅ Удаление обновления

#### Управление участниками

1. ✅ Просмотр списка участников
2. ✅ Отметка волонтера
3. ✅ Снятие отметки
4. ✅ Фильтрация участников

#### Архивация квеста

1. ✅ Открытие диалога архивации
2. ✅ Подтверждение архивации
3. ✅ Архивация квеста
4. ✅ Исчезновение из активных квестов

#### Завершение квеста

1. ✅ Открытие диалога завершения
2. ✅ Подтверждение завершения
3. ✅ Завершение квеста
4. ✅ Изменение статуса

### 3.3 Управление организациями

#### Создание организации

1. ✅ Вход в систему
2. ✅ Переход на страницу создания организации
3. ✅ Заполнение основной информации
4. ✅ Выбор города
5. ✅ Выбор типа организации
6. ✅ Выбор видов помощи
7. ✅ Ввод описания и миссии
8. ✅ Добавление целей и потребностей
9. ✅ Выбор местоположения
10. ✅ Добавление контактов
11. ✅ Загрузка галереи
12. ✅ Валидация
13. ✅ Отправка формы
14. ✅ Успешное создание

#### Редактирование организации

1. ✅ Переход на страницу управления организацией
2. ✅ Загрузка данных
3. ✅ Редактирование
4. ✅ Сохранение изменений

#### Управление обновлениями организации

1. ✅ Просмотр обновлений
2. ✅ Создание обновления
3. ✅ Редактирование обновления
4. ✅ Удаление обновления

### 3.4 Карта

#### Просмотр карты

1. ✅ Загрузка карты
2. ✅ Отображение маркеров квестов
3. ✅ Отображение маркеров организаций
4. ✅ Кластеризация маркеров
5. ✅ Загрузка геолокации пользователя
6. ✅ Центрирование на пользователе

#### Фильтрация на карте

1. ✅ Открытие фильтров
2. ✅ Выбор типа маркеров (все/квесты/организации)
3. ✅ Выбор города
4. ✅ Выбор типа организации
5. ✅ Выбор категории
6. ✅ Применение фильтров
7. ✅ Обновление маркеров на карте

#### Поиск на карте

1. ✅ Ввод адреса в поиск
2. ✅ Выбор адреса из результатов
3. ✅ Центрирование карты на адресе
4. ✅ Поиск квестов/организаций
5. ✅ Выбор из результатов поиска
6. ✅ Открытие деталей

#### Взаимодействие с маркерами

1. ✅ Клик на маркер квеста
2. ✅ Отображение попапа
3. ✅ Клик на маркер организации
4. ✅ Отображение попапа
5. ✅ Переход к деталям из попапа

#### Список элементов на карте

1. ✅ Открытие списка
2. ✅ Просмотр списка квестов/организаций
3. ✅ Выбор элемента из списка
4. ✅ Центрирование на выбранном элементе
5. ✅ Открытие деталей

#### Детали квеста/организации

1. ✅ Открытие деталей
2. ✅ Просмотр всей информации
3. ✅ Просмотр этапов (для квеста)
4. ✅ Просмотр галереи
5. ✅ Просмотр контактов
6. ✅ Закрытие деталей
7. ✅ Переход к управлению (для владельца)

### 3.5 Профиль пользователя

#### Просмотр профиля

1. ✅ Переход на страницу профиля
2. ✅ Отображение информации пользователя
3. ✅ Отображение статистики
4. ✅ Отображение достижений
5. ✅ Отображение участвующих квестов

#### Редактирование профиля

1. ✅ Открытие формы редактирования
2. ✅ Изменение данных
3. ✅ Загрузка аватара
4. ✅ Сохранение изменений
5. ✅ Обновление отображения

### 3.6 Навигация и маршрутизация

#### Навигация между страницами

1. ✅ Переход по ссылкам в header
2. ✅ Переход на главную
3. ✅ Переход на карту
4. ✅ Переход на профиль
5. ✅ Переход на создание квеста
6. ✅ Переход на создание организации
7. ✅ Переход на управление

#### Защищенные маршруты

1. ✅ Попытка доступа без авторизации
2. ✅ Редирект на логин
3. ✅ Доступ после авторизации
4. ✅ Доступ к управлению только для владельца

### 3.7 PWA функциональность

#### Установка PWA

1. ✅ Отображение кнопки установки (на мобильных)
2. ✅ Клик на установку
3. ✅ Подтверждение установки
4. ✅ Установка приложения
5. ✅ Запуск установленного приложения

#### Офлайн режим

1. ✅ Переключение в офлайн режим
2. ✅ Отображение уведомления
3. ✅ Работа с кэшированными данными
4. ✅ Переключение в онлайн режим
5. ✅ Синхронизация данных

### 3.8 Обработка ошибок

#### Ошибки API

1. ✅ Обработка 401 (неавторизован)
2. ✅ Автоматическое обновление токена
3. ✅ Обработка 403 (нет доступа)
4. ✅ Обработка 404 (не найдено)
5. ✅ Обработка 500 (ошибка сервера)
6. ✅ Отображение сообщений об ошибках

#### Ошибки валидации

1. ✅ Отображение ошибок валидации форм
2. ✅ Подсветка невалидных полей
3. ✅ Блокировка отправки при ошибках

#### Ошибки сети

1. ✅ Обработка отсутствия сети
2. ✅ Retry логика
3. ✅ Отображение сообщений

### 3.9 Граничные случаи

#### Лимиты

1. ✅ Создание максимального количества квестов
2. ✅ Попытка создать больше
3. ✅ Отображение ошибки
4. ✅ Создание максимального количества организаций

#### Большие данные

1. ✅ Загрузка большого количества квестов
2. ✅ Загрузка большого количества организаций
3. ✅ Производительность фильтрации
4. ✅ Производительность карты

#### Пустые состояния

1. ✅ Отображение при отсутствии квестов
2. ✅ Отображение при отсутствии организаций
3. ✅ Отображение при отсутствии участников

---

## 4. ПРИОРИТЕТЫ ТЕСТИРОВАНИЯ

### Высокий приоритет (критичные функции)

1. **Аутентификация** - вход, регистрация, восстановление пароля
2. **Создание квеста** - основная функциональность
3. **Карта** - отображение и фильтрация
4. **Защищенные маршруты** - безопасность
5. **API интеграция** - все endpoints
6. **Валидация форм** - все схемы

### Средний приоритет (важные функции)

1. **Редактирование квестов/организаций**
2. **Управление этапами и требованиями**
3. **Профиль пользователя**
4. **Управление участниками**
5. **PWA функциональность**

### Низкий приоритет (дополнительные функции)

1. **UI компоненты** - базовые компоненты
2. **Утилиты форматирования**
3. **Логирование**
4. **Вспомогательные хуки**

---

## 5. ИНСТРУМЕНТЫ И НАСТРОЙКА

### Рекомендуемые инструменты

#### Unit и Integration тесты

- **Vitest** - быстрый test runner
- **React Testing Library** - тестирование React компонентов
- **@testing-library/user-event** - симуляция пользовательских действий
- **MSW (Mock Service Worker)** - мокирование API запросов
- **@reduxjs/toolkit/query/react** - тестирование RTK Query

#### E2E тесты

- **Playwright** (рекомендуется) или **Cypress**
- Для тестирования карты может потребоваться специальная настройка

### Настройка тестового окружения

```json
// package.json
{
	"scripts": {
		"test": "vitest",
		"test:ui": "vitest --ui",
		"test:coverage": "vitest --coverage",
		"test:e2e": "playwright test"
	},
	"devDependencies": {
		"vitest": "^1.0.0",
		"@testing-library/react": "^14.0.0",
		"@testing-library/jest-dom": "^6.0.0",
		"@testing-library/user-event": "^14.0.0",
		"@vitest/ui": "^1.0.0",
		"@vitest/coverage-v8": "^1.0.0",
		"msw": "^2.0.0",
		"playwright": "^1.40.0",
		"@playwright/test": "^1.40.0"
	}
}
```

### Моки и фикстуры

Создать директории:

- `src/__tests__/mocks/` - моки данных
- `src/__tests__/fixtures/` - тестовые данные
- `src/__tests__/utils/` - утилиты для тестов
- `src/__tests__/setup/` - настройка тестового окружения

---

## 6. МЕТРИКИ ПОКРЫТИЯ

### Целевые показатели

- **Общее покрытие:** 90%
- **Утилиты:** 95%+
- **Хуки:** 90%+
- **Компоненты:** 85%+
- **Интеграционные тесты:** 80%+
- **E2E тесты:** покрытие всех критичных сценариев

### Отслеживание покрытия

- Использовать `@vitest/coverage-v8` для unit/integration
- Настроить CI/CD для автоматической проверки покрытия
- Блокировать merge при падении покрытия ниже 90%

---

## 7. CI/CD ИНТЕГРАЦИЯ

### Автоматический запуск тестов

1. **Pre-commit hooks** - запуск линтера и unit тестов
2. **Pull Request** - запуск всех unit и integration тестов
3. **Merge to main** - запуск всех тестов включая E2E
4. **Nightly builds** - полный прогон всех тестов

### Отчеты

- Публикация отчетов о покрытии
- Сохранение артефактов E2E тестов (скриншоты, видео)
- Уведомления о падении тестов

---

## 8. ДОПОЛНИТЕЛЬНЫЕ РЕКОМЕНДАЦИИ

### Тестирование карты (Leaflet)

- Использовать моки для Leaflet компонентов
- Тестировать логику без рендеринга карты
- Для E2E использовать headless браузер с поддержкой WebGL

### Тестирование PWA

- Использовать моки для Service Worker
- Тестировать логику установки
- E2E тесты для реальной установки

### Производительность

- Тесты производительности для больших списков
- Тесты производительности карты с множеством маркеров
- Тесты загрузки изображений

### Доступность (A11y)

- Тесты доступности форм
- Тесты навигации с клавиатуры
- Тесты для screen readers

---

## ЗАКЛЮЧЕНИЕ

Данный план тестирования обеспечивает:

- ✅ Полное покрытие критичной функциональности
- ✅ Тестирование всех уровней приложения
- ✅ Выявление багов на ранних этапах
- ✅ Уверенность в качестве кода
- ✅ Упрощение рефакторинга
- ✅ Документирование поведения системы

**Приоритет реализации:**

1. Unit тесты для утилит и хуков
2. Integration тесты для форм и API
3. E2E тесты для критичных пользовательских сценариев
4. Расширение покрытия до 90%
